<script type="text/javascript">

// 	$( "#main_container" ).on("click", ".functional", function() {
// 		alert("asd");
// 	});

	

 	function subscribeFunctionalityCharacterSheet(payload) {
 		switch(payload.option) {
 		case "individual":
 			alert("FUNCTIONALITY CHARACTER SHEET case individual");
 			break;
 		}
 	}

 	var individual_functionality_started = false;
 	var individual_functionality_last_element = false;
 	var individual_functionality_actual_character_sheet_id = false;
 	function vampireFunctionality (element) {
 		if (individual_functionality_started == false) {
 			generateIndividualFunctionalityPanel();
 			$( "#individual_functionality_panel" ).append("<div id="+element.id+"><span id='name'>"+
 					element.name+"</span><input id='value' type='number' value="+
 					element.value_list.value+"></input></div>");
			
 			$( "#individual_functionality_panel" ).append("<div id='result_type'><span id='type' style='display:none'>"+
 					element.result_type.type+"</span><span id='name'>"+
 					element.result_type.name+"</span><input id='value' type='number' value="+
 					element.result_type.value+"></input></div>");

 			$( "#individual_functionality_panel" ).append("<button id='individual_functionality_panel_add_button'>Add</button>");
 			$( "#individual_functionality_panel" ).append("<button id='individual_functionality_panel_throw_button'>Throw</button");
 			$( "#individual_functionality_panel" ).append("<button id='individual_functionality_panel_cancel_button'>Cancel</button");

 			individual_functionality_started = true;
 			individual_functionality_actual_character_sheet_id = element.character_sheet_id;
 			individual_functionality_last_element = element.id;
 		}
 		else {
 			$( "#individual_functionality_panel > #"+individual_functionality_last_element ).after("<div id="+element.id+"><span id='name'>"+
 					element.name+"</span><input id='value' type='number' value="+
 					element.value_list.value+"></input></div>");

 			individual_functionality_last_element = element.id;
 		}
 	}

 	function generateIndividualFunctionalityPanel() {
 		$( "#"+user_username ).append("<div id='individual_functionality_panel'></div>");
 	}

 	$( "#"+user_username ).on("click", ".functional", function() {
 		var character_sheet_id = getCharacterSheetIdFromElement($(this));
 		if(character_sheet_id) {
 			if(individual_functionality_actual_character_sheet_id === false || 
 				individual_functionality_actual_character_sheet_id == character_sheet_id) {
 				var element = { 
 					    id: $(this).attr("id"),
 					    name: $(this).children( "#name" ).text(),
 					    character_sheet_id: character_sheet_id,
 					    value_list: {value: $(this).children( "#value" ).text()},
 					    result_type: {type: "number_of_successes", name: "Difficulty", value: "6"}
 					};
 				vampireFunctionality(element);
 			}
 		}
 	});

 	//})[id*="td_"] to id of character sheet
 	$( "#"+user_username ).on("click", "div > #atributtes > div > div", function() {
 		var character_sheet_id = getCharacterSheetIdFromElement($(this));
 		if(character_sheet_id) {
 			if(individual_functionality_actual_character_sheet_id === false || 
 				individual_functionality_actual_character_sheet_id == character_sheet_id) {
 				var element = { 
 					    id: $(this).attr("id"),
 					    name: $(this).children( "#name" ).text(),
 					    character_sheet_id: character_sheet_id,
 					    value_list: {value: $(this).children( "#value" ).text()},
 					    result_type: {type: "number_of_successes", name: "Difficulty", value: "6"}
 					};
 				vampireFunctionality(element);
 			}
 		}
 	});

 	$( "#"+user_username ).on("click", "div > #abilities > div > div", function() {
 		var character_sheet_id = getCharacterSheetIdFromElement($(this));

 		if(character_sheet_id) {
 			if(individual_functionality_actual_character_sheet_id === false || 
 				individual_functionality_actual_character_sheet_id == character_sheet_id) {
 				var element = { 
 					    id: $(this).attr("id"),
 					    name: $(this).children( "#name" ).text(),
 					    character_sheet_id: character_sheet_id,
 					    value_list: {value: $(this).children( "#value" ).text()},
 					    result_type: {type: "number_of_successes", name: "Difficulty", value: "6"}
 					};
 				vampireFunctionality(element);
 			}
 		}
 	});

 	function deleteFunctionalityPanel () {
 		$("#"+user_username+" > #individual_functionality_panel").remove();
 		individual_functionality_started = false;
 		individual_functionality_last_element = false;
 		individual_functionality_actual_character_sheet_id = false;
 	}

</script>